<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L1é‹å‹•å®¶çš„é¢¨åº¦-å¤šå­—éŸ³ç·´ç¿’</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #fff7ed; 
        }
        ::-webkit-scrollbar-thumb {
            background: #fdba74; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #fb923c; 
        }
        .progress-bar {
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes heartbeat {
            0% { transform: scale(1); }
            25% { transform: scale(1.2); }
            50% { transform: scale(1); }
            75% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .heart-click {
            animation: heartbeat 0.4s ease-in-out;
        }
        
        /* Status Dot Styles */
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }
        .status-loading { background-color: #fbbf24; box-shadow: 0 0 8px #fbbf24; } /* Amber-400 */
        .status-success { background-color: #4ade80; box-shadow: 0 0 8px #4ade80; } /* Green-400 */
        .status-error { background-color: #ef4444; box-shadow: 0 0 8px #ef4444; } /* Red-500 */

        /* åˆå§‹åŠ è¼‰é®ç½© */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff7ed;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            transition: opacity 0.5s;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ea580c;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-orange-50">
    <!-- åˆå§‹åŠ è¼‰ç•«é¢ï¼Œé˜²æ­¢ç™½å± -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <p class="mt-4 text-orange-600 font-bold">æ­£åœ¨è¼‰å…¥å¤šå­—éŸ³ç·´ç¿’...</p>
    </div>

    <div id="root"></div>

    <!-- 1. æ¨¡çµ„é åŠ è¼‰å™¨ (Module Pre-loader) -->
    <!-- ä¿®å¾©ç™½å±çš„é—œéµï¼šå…ˆè¼‰å…¥æ¨¡çµ„ï¼Œæ›è¼‰åˆ° windowï¼Œå†åŸ·è¡Œ React -->
    <script type="module">
        // å°å…¥ React
        import React from "https://esm.sh/react@18.2.0";
        import ReactDOM from "https://esm.sh/react-dom@18.2.0/client";
        
        // å°å…¥ UI çµ„ä»¶åº“ Lucide React
        import * as Lucide from "https://esm.sh/lucide-react@0.263.1";
        
        // å°å…¥ç‰¹æ•ˆåº“
        import confetti from "https://esm.sh/canvas-confetti@1.9.2";
        
        // å°å…¥ Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDoc, updateDoc, onSnapshot, arrayUnion, arrayRemove, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // å°‡æ¨¡çµ„æ›è¼‰åˆ°å…¨å±€ window å°è±¡
        window.React = React;
        window.ReactDOM = ReactDOM;
        window.Lucide = Lucide;
        window.confetti = confetti;
        window.Firebase = {
            initializeApp,
            getFirestore, collection, doc, setDoc, getDoc, updateDoc, onSnapshot, arrayUnion, arrayRemove, deleteDoc,
            getAuth, signInAnonymously, onAuthStateChanged
        };

        // é€šçŸ¥æ‡‰ç”¨ç¨‹åºä¾è³´å·²æº–å‚™å°±ç·’
        window.dispatchEvent(new Event('modules-loaded'));
    </script>

    <!-- 2. ä¸»æ‡‰ç”¨ç¨‹åºé‚è¼¯ (Main App Logic) -->
    <script type="text/babel">
        // ç­‰å¾…æ¨¡çµ„åŠ è¼‰å®Œæˆå¾Œå†å•Ÿå‹• React
        window.addEventListener('modules-loaded', () => {
            initApp();
        });

        // ä¿éšªèµ·è¦‹çš„æª¢æŸ¥
        if (window.React && window.Firebase) {
             setTimeout(initApp, 100);
        }

        function initApp() {
            // éš±è—åŠ è¼‰ç•«é¢
            const loader = document.getElementById('loading-overlay');
            if (loader) {
                loader.style.opacity = '0';
                setTimeout(() => loader.remove(), 500);
            }

            // --- è®Šé‡è§£æ§‹ (æ›¿ä»£ import) ---
            const { useState, useEffect, useCallback } = window.React;
            const { createRoot } = window.ReactDOM;
            const { BookOpen, List, Sun, User, LogOut, Zap, Heart, BookX, CheckCircle, XCircle, Tag, X } = window.Lucide;
            const confetti = window.confetti;
            
            // Firebase å‡½æ•¸è§£æ§‹
            const { initializeApp, getFirestore, collection, doc, setDoc, getDoc, updateDoc, onSnapshot, arrayUnion, arrayRemove, deleteDoc, getAuth, signInAnonymously, onAuthStateChanged } = window.Firebase;

            // --- Firebase Configuration ---
            const firebaseConfig = {
                apiKey: "AIzaSyAxQFt76ZPXE7d0i1XeNZ1yiiD2WYNIfHs",
                authDomain: "chinese-learning-47f4d.firebaseapp.com",
                projectId: "chinese-learning-47f4d",
                storageBucket: "chinese-learning-47f4d.firebasestorage.app",
                messagingSenderId: "76289812052",
                appId: "1:76289812052:web:898384a916f9f341f62fc1"
            };

            // Initialize Firebase
            // ç°¡å–®éŒ¯èª¤è™•ç†ï¼Œé¿å…å› ç‚º API Key æ›¿æ›æ–‡å­—å ±éŒ¯
            let app, db, auth;
            try {
                if (firebaseConfig.apiKey !== "è«‹å¡«å…¥æ‚¨çš„API_KEY") {
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                } else {
                    console.warn("å°šæœªè¨­å®š Firebase Config");
                }
            } catch (e) {
                console.error("Firebase Init Error:", e);
            }

            // --- CONSTANTS ---
            const STORAGE_PREFIX = 'Chinese4-L1-2';
            const COLLECTION_NAME = STORAGE_PREFIX; 
            const DOC_GLOBAL = 'global_users'; 

            // è³‡æ–™åº«
            const rawData = [
                // 1. é£²
                { id: 101, char: "é£²", question: "ä¸‹è€Œã€Œé£²ã€", answer: "ã„§ã„£Ë‹", partOfSpeech: "å‹•è©", meaning: "ç‰¹æŒ‡çµ¦ç‰²å£å–æ°´ã€ä½¿å–æ°´ã€‚", sentence: "å¤ä»£å°‡å£«é•·é€”è·‹æ¶‰ï¼Œè¦‹æºªæ°´æ¸…æ¾ˆï¼Œé‚ä¸‹é¦¬è®“æˆ°é¦¬å–æ°´ï¼Œæ­¤å³ä¸‹è€Œé£²ã€‚", distractors: ["ã„§ã„£Ë‡"] },
                { id: 102, char: "é£²", question: "ã€Œé£²ã€é¦¬é•·åŸ", answer: "ã„§ã„£Ë‹", partOfSpeech: "å‹•è©", meaning: "ç‰¹æŒ‡çµ¦ç‰²å£å–æ°´ã€ä½¿å–æ°´ã€‚", sentence: "å‚³èªªç§¦æœå¤§å°‡è’™æ¬æ›¾ç‡è»åŒ—ä¸Šï¼Œé§å®ˆé‚Šç–†ä¸¦é£²é¦¬é•·åŸçªŸã€‚", distractors: ["ã„§ã„£Ë‡"] },
                { id: 103, char: "é£²", question: "é€ ã€Œé£²ã€è¼’ç›¡", answer: "ã„§ã„£Ë‡", partOfSpeech: "å‹•è©", meaning: "å–ã€å¸é£Ÿã€‚", sentence: "é™¶æ·µæ˜ç”Ÿæ€§å—œé…’ï¼Œè¦ªå‹ç½®é…’æ‹›å¾…ï¼Œä»–ç¸½æ˜¯é€ é£²è¼’ç›¡ï¼ˆä¸€å»å–å°±å–å€‹ç²¾å…‰ï¼‰ã€‚", distractors: ["ã„§ã„£Ë‹"] },
                { id: 104, char: "é£²", question: "ã€Œé£²ã€æ°´æ€æº", answer: "ã„§ã„£Ë‡", partOfSpeech: "å‹•è©", meaning: "å«å¿ã€æ‡·è‘—ï¼ˆéš±è—åœ¨å¿ƒä¸­ï¼‰ã€‚", sentence: "åšäººè¦é£²æ°´æ€æºï¼Œä¸å¯å¿˜æ©è² ç¾©ã€‚", distractors: ["ã„§ã„£Ë‹"] },
                { id: 105, char: "é£²", question: "ã€Œé£²ã€æ¨", answer: "ã„§ã„£Ë‡", partOfSpeech: "å‹•è©", meaning: "å«å¿ã€æ‡·è‘—ï¼ˆéš±è—åœ¨å¿ƒä¸­ï¼‰ã€‚", sentence: "é€™æ¬¡æ¯”è³½åªå·®ä¸€åˆ†å°±å¥ªå† ï¼Œå…¨éšŠåªèƒ½é£²æ¨è€Œæ­¸ã€‚", distractors: ["ã„§ã„£Ë‹"] },

                // 2. å‚³
                { id: 201, char: "å‚³", question: "ã€Œå‚³ã€è¨˜", answer: "ã„“ã„¨ã„¢Ë‹", partOfSpeech: "åè©", meaning: "è¨˜è¼‰äººç‰©ç”Ÿå¹³äº‹è¹Ÿçš„æ›¸ç±ã€‚", sentence: "é€™æœ¬å‚³è¨˜è©³ç´°è¨˜éŒ„äº†è³ˆä¼¯æ–¯å‚³å¥‡çš„ä¸€ç”Ÿã€‚", distractors: ["ã„”ã„¨ã„¢ËŠ"] },
                { id: 202, char: "å‚³", question: "å·¦ã€Œå‚³ã€", answer: "ã„“ã„¨ã„¢Ë‹", partOfSpeech: "åè©", meaning: "è§£é‡‹ç¶“ç¾©çš„æ›¸ç±ï¼ˆå¦‚ï¼šæ˜¥ç§‹ä¸‰å‚³ï¼‰ã€‚", sentence: "ã€Šå·¦å‚³ã€‹æ“…é•·æ•˜äº‹ï¼Œæ˜¯ç ”ç©¶æ˜¥ç§‹æ­·å²çš„é‡è¦å…¸ç±ã€‚", distractors: ["ã„”ã„¨ã„¢ËŠ"] },
                { id: 203, char: "å‚³", question: "ã€Œå‚³ã€ç¥", answer: "ã„”ã„¨ã„¢ËŠ", partOfSpeech: "å‹•è©", meaning: "ææ‘¹å‚³å¯«å¾—å¾ˆé€¼çœŸã€‚", sentence: "é€™å¹…ç•«åƒç•«å¾—éå¸¸å‚³ç¥ï¼Œå½·å½¿çœŸäººå°±åœ¨çœ¼å‰ã€‚", distractors: ["ã„“ã„¨ã„¢Ë‹"] },
                { id: 204, char: "å‚³", question: "ã€Œå‚³ã€æŸ“", answer: "ã„”ã„¨ã„¢ËŠ", partOfSpeech: "å‹•è©", meaning: "è½‰æˆã€æ•£å¸ƒã€éé€ã€‚", sentence: "æµè¡Œæ€§æ„Ÿå†’çš„å‚³æŸ“åŠ›å¾ˆå¼·ï¼Œå‡ºå…¥å…¬å…±å ´æ‰€è¦æˆ´å£ç½©ã€‚", distractors: ["ã„“ã„¨ã„¢Ë‹"] },
                { id: 205, char: "å‚³", question: "ã€Œå‚³ã€è©±", answer: "ã„”ã„¨ã„¢ËŠ", partOfSpeech: "å‹•è©", meaning: "è½‰æˆã€æ•£å¸ƒã€éé€ã€‚", sentence: "è«‹å¹«æˆ‘å‚³è©±çµ¦ç¶“ç†ï¼Œèªªæˆ‘æ˜å¤©æœƒæº–æ™‚å ±åˆ°ã€‚", distractors: ["ã„“ã„¨ã„¢Ë‹"] },
                { id: 206, char: "å‚³", question: "ã€Œå‚³ã€è—", answer: "ã„”ã„¨ã„¢ËŠ", partOfSpeech: "å‹•è©", meaning: "è½‰æˆã€æ•£å¸ƒã€éé€ã€‚", sentence: "è€è—å¸«è‡´åŠ›æ–¼å‚³è—ï¼Œå¸Œæœ›å‚³çµ±æ–‡åŒ–ä¸è‡´å¤±å‚³ã€‚", distractors: ["ã„“ã„¨ã„¢Ë‹"] },

                // 3. èª¿
                { id: 301, char: "èª¿", question: "å”ã€Œèª¿ã€", answer: "ã„Šã„§ã„ ËŠ", partOfSpeech: "å‹•è©", meaning: "èª¿å’Œã€ä½¿å’Œè§£é…åˆã€‚", sentence: "ç¶“éè€å¸«çš„å”èª¿ï¼Œé€™å…©ä½åŒå­¸çµ‚æ–¼æ¡æ‰‹è¨€å’Œã€‚", distractors: ["ã„‰ã„§ã„ Ë‹"] },
                { id: 302, char: "èª¿", question: "ã€Œèª¿ã€å‘³", answer: "ã„Šã„§ã„ ËŠ", partOfSpeech: "å‹•è©", meaning: "æ··åˆã€èª¿é…ã€‚", sentence: "åª½åª½ç”¨å°‘è¨±é¹½å·´å¹«é€™é‹æ¹¯èª¿å‘³ï¼Œå‘³é“é®®ç¾æ¥µäº†ã€‚", distractors: ["ã„‰ã„§ã„ Ë‹"] },
                { id: 303, char: "èª¿", question: "ã€Œèª¿ã€æˆ²", answer: "ã„Šã„§ã„ ËŠ", partOfSpeech: "å‹•è©", meaning: "æˆ²å¼„ã€æŒ‘é€—ã€‚", sentence: "è¼•è–„çš„è¨€èªèª¿æˆ²ä»–äººï¼Œæ˜¯éå¸¸ä¸å°Šé‡çš„è¡Œç‚ºã€‚", distractors: ["ã„‰ã„§ã„ Ë‹"] },
                { id: 304, char: "èª¿", question: "ã€Œèª¿ã€åº¦", answer: "ã„‰ã„§ã„ Ë‹", partOfSpeech: "å‹•è©", meaning: "æ´¾é£ã€å®‰æ’ã€‚", sentence: "ç‚ºäº†è¶•å·¥ï¼Œå·¥åœ°ä¸»ä»»ç·Šæ€¥èª¿åº¦äº†å…©å°èµ·é‡æ©Ÿä¾†æ”¯æ´ã€‚", distractors: ["ã„Šã„§ã„ ËŠ"] },
                { id: 305, char: "èª¿", question: "é™³è…”æ¿«ã€Œèª¿ã€", answer: "ã„‰ã„§ã„ Ë‹", partOfSpeech: "åè©", meaning: "æ¨‚æ›²ã€æ ¼èª¿ã€æ„è¦‹ã€é¢¨æ ¼ã€‚", sentence: "ä»–çš„æ¼”è¬›å……æ»¿äº†é™³è…”æ¿«èª¿ï¼Œè½å¾—è§€çœ¾æ˜æ˜æ¬²ç¡ã€‚", distractors: ["ã„Šã„§ã„ ËŠ"] },
                { id: 306, char: "èª¿", question: "å–®ã€Œèª¿ã€", answer: "ã„‰ã„§ã„ Ë‹", partOfSpeech: "åè©", meaning: "æ¨‚æ›²ã€æ ¼èª¿ã€æ„è¦‹ã€é¢¨æ ¼ã€‚", sentence: "æ¯å¤©åšé‡è¤‡çš„å·¥ä½œé›£å…æœƒè¦ºå¾—ç”Ÿæ´»å–®èª¿ä¹å‘³ã€‚", distractors: ["ã„Šã„§ã„ ËŠ"] },
                { id: 307, char: "èª¿", question: "è«–ã€Œèª¿ã€", answer: "ã„‰ã„§ã„ Ë‹", partOfSpeech: "åè©", meaning: "æ¨‚æ›²ã€æ ¼èª¿ã€æ„è¦‹ã€é¢¨æ ¼ã€‚", sentence: "é€™ç¨®æ‚²è§€çš„è«–èª¿ï¼Œå°æ–¼è§£æ±ºå•é¡Œä¸€é»å¹«åŠ©ä¹Ÿæ²’æœ‰ã€‚", distractors: ["ã„Šã„§ã„ ËŠ"] },

                // 4. è¡Œ
                { id: 401, char: "è¡Œ", question: "ã€Œè¡Œã€å¿…æœ", answer: "ã„’ã„§ã„¥ËŠ", partOfSpeech: "å‹•è©", meaning: "åšã€å¯¦è¸ã€‚", sentence: "å›å­è¨€å¿…ä¿¡ï¼Œè¡Œå¿…æœï¼ˆèªªè©±å®ˆä¿¡ï¼Œåšäº‹æœæ–·ï¼‰ã€‚", distractors: ["ã„ã„¤ËŠ"] },
                { id: 402, char: "è¡Œ", question: "å“ã€Œè¡Œã€", answer: "ã„’ã„§ã„¥Ë‹", partOfSpeech: "åè©", meaning: "è¡Œç‚ºèˆ‰æ­¢ã€‚", sentence: "å­¸æ ¡ä¸åƒ…é‡è¦–æˆç¸¾ï¼Œæ›´çœ‹é‡å­¸ç”Ÿçš„å“è¡Œä¿®é¤Šã€‚", distractors: ["ã„ã„¤Ë‹"] },
                { id: 403, char: "è¡Œ", question: "ä¾¿å®œã€Œè¡Œã€äº‹", answer: "ã„’ã„§ã„¥ËŠ", partOfSpeech: "å‹•è©", meaning: "åšäº‹ã€åŸ·è¡Œã€‚", sentence: "ç¾å ´æƒ…æ³ç·Šæ€¥ï¼ŒæŒ‡æ®å®˜æ±ºå®šä¾¿å®œè¡Œäº‹ï¼Œå…ˆæ•‘äººè¦ç·Šã€‚", distractors: ["ã„ã„¤ËŠ"] },
                { id: 404, char: "è¡Œ", question: "æ’ã€Œè¡Œã€", answer: "ã„ã„¤ËŠ", partOfSpeech: "åè©", meaning: "é•·å¹¼æ¬¡åºã€‚", sentence: "ä»–åœ¨å®¶ä¸­æ’è¡Œè€ä¸‰ï¼Œä¸Šé¢é‚„æœ‰å…©å€‹å“¥å“¥ã€‚", distractors: ["ã„’ã„§ã„¥ËŠ"] },
                { id: 405, char: "è¡Œ", question: "éš”ã€Œè¡Œã€å¦‚éš”å±±", answer: "ã„ã„¤ËŠ", partOfSpeech: "åè©", meaning: "è¡Œæ¥­ã€è·æ¥­é¡åˆ¥ã€‚", sentence: "ä¿—è©±èªªéš”è¡Œå¦‚éš”å±±ï¼Œä¸æ˜¯é€™å€‹é ˜åŸŸçš„å°ˆå®¶å¾ˆé›£ç†è§£å…¶ä¸­çš„é–€é“ã€‚", distractors: ["ã„’ã„§ã„¥ËŠ"] },

                // 5. ä¾¿
                { id: 501, char: "ä¾¿", question: "æ–¹ã€Œä¾¿ã€", answer: "ã„…ã„§ã„¢Ë‹", partOfSpeech: "å½¢å®¹è©", meaning: "é †åˆ©ã€ç°¡æ˜“ã€åˆå®œã€‚", sentence: "é€™è£¡äº¤é€šæ–¹ä¾¿ï¼Œé™„è¿‘å°±æœ‰æ·é‹ç«™ã€‚", distractors: ["ã„†ã„§ã„¢ËŠ"] },
                { id: 502, char: "ä¾¿", question: "ã€Œä¾¿ã€å®œè¡Œäº‹", answer: "ã„…ã„§ã„¢Ë‹", partOfSpeech: "å½¢å®¹è©", meaning: "æ¬Šå®œè®Šé€šï¼ˆæ­¤è™•ã€Œä¾¿å®œã€éŸ³ã„…ã„§ã„¢Ë‹ ã„§ËŠï¼‰ã€‚", sentence: "æ—¢ç„¶æ³•è¦æœ‰å½ˆæ€§ç©ºé–“ï¼Œæˆ‘å€‘å°±è¦–æƒ…æ³ä¾¿å®œè¡Œäº‹å§ã€‚", distractors: ["ã„†ã„§ã„¢ËŠ"] },
                { id: 503, char: "ä¾¿", question: "ã€Œä¾¿ã€å®œ", answer: "ã„†ã„§ã„¢ËŠ", partOfSpeech: "å½¢å®¹è©", meaning: "åƒ¹éŒ¢ä½å»‰ã€‚", sentence: "é€™å®¶åº—çš„è¡£æœæ—¢ä¾¿å®œåˆè€ç©¿ï¼Œæ·±å—å­¸ç”Ÿå–œæ„›ã€‚", distractors: ["ã„…ã„§ã„¢Ë‹"] },
                { id: 504, char: "ä¾¿", question: "å å°ã€Œä¾¿ã€å®œ", answer: "ã„†ã„§ã„¢ËŠ", partOfSpeech: "åè©", meaning: "ä¸æ‡‰å¾—çš„åˆ©ç›Šã€‚", sentence: "åšäººè¦è…³è¸å¯¦åœ°ï¼Œä¸è¦è€æƒ³è‘—å å°ä¾¿å®œã€‚", distractors: ["ã„…ã„§ã„¢Ë‹"] },

                // 6. ç¨±
                { id: 601, char: "ç¨±", question: "ã€Œç¨±ã€å¿«", answer: "ã„”ã„¥", partOfSpeech: "å‹•è©", meaning: "å«å¥½ã€èªªã€‚", sentence: "æƒ¡éœ¸çµ‚æ–¼è¢«è­¦æ–¹é€®æ•ï¼Œé„‰è¦ªå€‘ç„¡ä¸æ‹æ‰‹ç¨±å¿«ã€‚", distractors: ["ã„”ã„£Ë‹"] },
                { id: 602, char: "ç¨±", question: "ã€Œç¨±ã€è®š", answer: "ã„”ã„¥", partOfSpeech: "å‹•è©", meaning: "è®šè¨±ã€è¡¨æšã€‚", sentence: "è€å¸«ç¨±è®šä»–çš„ä½œæ–‡å¯«å¾—éå¸¸æœ‰æ„Ÿæƒ…ã€‚", distractors: ["ã„”ã„£Ë‹"] },
                { id: 603, char: "ç¨±", question: "å‹»ã€Œç¨±ã€", answer: "ã„”ã„£Ë‹", partOfSpeech: "å‹•è©", meaning: "é©åˆã€ç›¸é…ã€å‡å‹»ã€‚", sentence: "ç¶“éé•·æœŸçš„å¥èº«ï¼Œä»–çš„èº«æè®Šå¾—éå¸¸å‹»ç¨±çµå¯¦ã€‚", distractors: ["ã„”ã„¥"] },

                // 7. æ›¾
                { id: 701, char: "æ›¾", question: "ã€Œæ›¾ã€æ˜¯ä»¥ç‚ºå­ä¹", answer: "ã„—ã„¥", partOfSpeech: "å‰¯è©", meaning: "ç«Ÿç„¶ã€é›£é“ï¼ˆä¹ƒã€ç«Ÿï¼‰ã€‚", sentence: "å­”å­æ›¾æ„Ÿå˜†åƒ…æœ‰ä¾›é¤Šçˆ¶æ¯æ˜¯ä¸å¤ çš„ï¼šã€Œæ›¾æ˜¯ä»¥ç‚ºå­ä¹ï¼Ÿã€ï¼ˆé›£é“é€™å°±å«åšå­é †äº†å—ï¼Ÿï¼‰", distractors: ["ã„˜ã„¥ËŠ"] },
                { id: 702, char: "æ›¾", question: "ã€Œæ›¾ã€åƒ", answer: "ã„—ã„¥", partOfSpeech: "åè©", meaning: "å§“æ°ã€‚", sentence: "æ›¾åƒæ˜¯å­”å­çš„å¾—æ„é–€ç”Ÿï¼Œä»¥å­é †èåã€‚", distractors: ["ã„˜ã„¥ËŠ"] },
                { id: 703, char: "æ›¾", question: "ã€Œæ›¾ã€ç¶“", answer: "ã„˜ã„¥ËŠ", partOfSpeech: "å‰¯è©", meaning: "éå»çš„ç¶“æ­·ã€è¡¨ç¤ºå·²ç¶“éã€‚", sentence: "æˆ‘æ›¾ç¶“å»éé‚£åº§é«˜å±±ï¼Œé¢¨æ™¯ç¾ä¸å‹æ”¶ã€‚", distractors: ["ã„—ã„¥"] },
                { id: 704, char: "æ›¾", question: "æœªã€Œæ›¾ã€", answer: "ã„˜ã„¥ËŠ", partOfSpeech: "å‰¯è©", meaning: "éå»çš„ç¶“æ­·ã€è¡¨ç¤ºå·²ç¶“éã€‚", sentence: "æˆ‘å€‘æœªæ›¾è¦‹é¢ï¼Œä½†æˆ‘å°ä»–çš„å¤§åæ—©æœ‰è€³èã€‚", distractors: ["ã„—ã„¥"] },

                // 8. è·
                { id: 801, char: "è·", question: "è² ã€Œè·ã€", answer: "ã„ã„œË‹", partOfSpeech: "å‹•è©", meaning: "æ‰¿æ“”ã€æ“”è² ï¼ˆé‡é‡æˆ–è²¬ä»»ï¼‰ã€‚", sentence: "é€™é …å·¥ä½œçš„é«”åŠ›è² è·å¾ˆé‡ï¼Œéœ€è¦å¼·å£¯çš„äººæ‰èƒ½å‹ä»»ã€‚", distractors: ["ã„ã„œËŠ"] },
                { id: 802, char: "è·", question: "ã€Œè·ã€èŠ±", answer: "ã„ã„œËŠ", partOfSpeech: "åè©", meaning: "æ¤ç‰©åï¼ˆè“®èŠ±ï¼‰ã€‚", sentence: "å¤å¤©çš„æ± å¡˜è£¡é–‹æ»¿äº†ç²‰ç´…è‰²çš„è·èŠ±ï¼Œéš¨é¢¨æ–æ›³ã€‚", distractors: ["ã„ã„œË‹"] },

                // 9. æ›´
                { id: 901, char: "æ›´", question: "ä¸‰ã€Œæ›´ã€åŠå¤œ", answer: "ã„ã„¥", partOfSpeech: "é‡è©", meaning: "å¤ä»£å¤œé–“è¨ˆæ™‚å–®ä½ï¼ˆä¸€å¤œåˆ†äº”æ›´ï¼‰ã€‚", sentence: "ä½ ä¸è¦ä¸‰æ›´åŠå¤œå¤§è²å–§å˜©ï¼Œæœƒåµåˆ°é„°å±…ç¡è¦ºã€‚", distractors: ["ã„ã„¥Ë‹"] },
                { id: 902, char: "æ›´", question: "ã€Œæ›´ã€æ›´åŠ ", answer: "ã„ã„¥Ë‹", partOfSpeech: "å‰¯è©", meaning: "æ„ˆã€å†ï¼ˆç¨‹åº¦åŠ æ·±ï¼‰ã€‚", sentence: "ç¶“éé€™æ¬¡æ•™è¨“ï¼Œä»–åšäº‹è®Šå¾—æ›´åŠ è¬¹æ…å°å¿ƒäº†ã€‚", distractors: ["ã„ã„¥"] },

                // 10. å¼·
                { id: 1001, char: "å¼·", question: "å€”ã€Œå¼·ã€", answer: "ã„ã„§ã„¤Ë‹", partOfSpeech: "å½¢å®¹è©", meaning: "å›ºåŸ·ã€ä¸é †å¾ã€‚", sentence: "é€™å­©å­å€‹æ€§å€”å¼·ï¼Œèªå®šäº†ç›®æ¨™å°±ä¸è¼•æ˜“æ”¹è®Šã€‚", distractors: ["ã„‘ã„§ã„¤ËŠ"] },
                { id: 1002, char: "å¼·", question: "ã€Œå¼·ã€å‹", answer: "ã„‘ã„§ã„¤ËŠ", partOfSpeech: "å½¢å®¹è©", meaning: "åŠ›é‡å¤§çš„ã€çŒ›çƒˆçš„ã€‚", sentence: "é¢±é¢¨å¸¶ä¾†äº†å¼·å‹çš„é¢¨å‹¢ï¼Œå¹å€’äº†è·¯é‚Šçš„å¤§æ¨¹ã€‚", distractors: ["ã„ã„§ã„¤Ë‹"] },
                { id: 1003, char: "å¼·", question: "ã€Œå¼·ã€è€…", answer: "ã„‘ã„§ã„¤ËŠ", partOfSpeech: "å½¢å®¹è©", meaning: "æœ‰æ¬Šå‹¢æˆ–åŠ›é‡çš„äººï¼ˆæ­¤æŒ‡ä¿®é£¾ã€Œè€…ã€çš„å±¬æ€§ï¼‰ã€‚", sentence: "åœ¨ç«¶æŠ€å ´ä¸Šï¼Œåªæœ‰ä¸æ–·åŠªåŠ›æ‰èƒ½æˆç‚ºçœŸæ­£çš„å¼·è€…ã€‚", distractors: ["ã„ã„§ã„¤Ë‹"] },

                // 11. è«¸
                { id: 1101, char: "è«¸", question: "å…¬ã€Œè«¸ã€", answer: "ã„“ã„¨", partOfSpeech: "å…¼è©", meaning: "ã€Œä¹‹æ–¼ã€äºŒå­—çš„åˆéŸ³ï¼ˆç½®æ–¼ï¼‰ã€‚", sentence: "ç‚ºäº†å…¬å¹³èµ·è¦‹ï¼Œå§”å“¡æœƒæ±ºå®šå°‡æ±ºç­–éç¨‹å…¬è«¸ç¤¾æœƒå¤§çœ¾ã€‚", distractors: ["ã„“ã„¨Ë‹"] },
                { id: 1102, char: "è«¸", question: "ã€Œè«¸ã€ä½", answer: "ã„“ã„¨", partOfSpeech: "å½¢å®¹è©", meaning: "çœ¾å¤šã€å„å€‹ã€‚", sentence: "è«¸ä½å˜‰è³“è«‹å°±åº§ï¼Œå…¸ç¦®é¦¬ä¸Šå°±è¦é–‹å§‹äº†ã€‚", distractors: ["ã„“ã„¨Ë‹"] },
                { id: 1103, char: "è«¸", question: "ã€Œè«¸ã€å¤š", answer: "ã„“ã„¨", partOfSpeech: "å½¢å®¹è©", meaning: "çœ¾å¤šã€å„å€‹ã€‚", sentence: "ç”±æ–¼æ™‚é–“å€‰ä¿ƒï¼Œæ‹›å¾…ä¸å‘¨ä¹‹è™•å°šè«‹è«¸å¤šåŒ…æ¶µã€‚", distractors: ["ã„“ã„¨Ë‹"] },

                // 12. æ¨‚
                { id: 1201, char: "æ¨‚", question: "å¿«ã€Œæ¨‚ã€", answer: "ã„Œã„œË‹", partOfSpeech: "å½¢å®¹è©", meaning: "å–œæ‚…ã€æ­¡å–œã€‚", sentence: "åŠ©äººç‚ºå¿«æ¨‚ä¹‹æœ¬ï¼Œå¹«åŠ©åˆ¥äººè‡ªå·±ä¹Ÿæœƒæ„Ÿåˆ°é–‹å¿ƒã€‚", distractors: ["ã„©ã„Ë‹", "ã„§ã„ Ë‹"] },
                { id: 1202, char: "æ¨‚", question: "å¯“æ•™æ–¼ã€Œæ¨‚ã€", answer: "ã„Œã„œË‹", partOfSpeech: "åè©", meaning: "å¯„è¨—ï¼ˆå°‡æ•™è‚²å¯„è¨—åœ¨æ¨‚è¶£ä¸­ï¼‰ã€‚", sentence: "é€™æ¬¾éŠæˆ²è¨­è¨ˆå¾—å¾ˆå¥½ï¼ŒçœŸæ­£åšåˆ°äº†å¯“æ•™æ–¼æ¨‚ã€‚", distractors: ["ã„©ã„Ë‹", "ã„§ã„ Ë‹"] },
                { id: 1203, char: "æ¨‚", question: "éŸ³ã€Œæ¨‚ã€", answer: "ã„©ã„Ë‹", partOfSpeech: "åè©", meaning: "æœ‰è¦å¾‹è€Œæ‚…è€³çš„è²éŸ³ã€‚", sentence: "è½è¼•æŸ”çš„éŸ³æ¨‚å¯ä»¥å¹«åŠ©æ”¾é¬†å¿ƒæƒ…ã€‚", distractors: ["ã„Œã„œË‹", "ã„§ã„ Ë‹"] },
                { id: 1204, char: "æ¨‚", question: "ã€Œæ¨‚ã€å±±ã€Œæ¨‚ã€æ°´", answer: "ã„§ã„ Ë‹", partOfSpeech: "å‹•è©", meaning: "å–œå¥½ã€æ¬£è³ï¼ˆå¤šç”¨æ–¼å¤æ–‡ï¼‰ã€‚", sentence: "å­”å­èªªï¼šã€Œä»è€…æ¨‚å±±ï¼Œæ™ºè€…æ¨‚æ°´ã€‚ã€ï¼ˆä»æ…ˆçš„äººå–œæ„›å±±ï¼‰ã€‚", distractors: ["ã„Œã„œË‹", "ã„©ã„Ë‹"] },
            ];

            // --- Helper Functions ---
            const shuffleArray = (array) => {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            };

            const playSound = (type) => {
                const audioPath = type === 'success' ? 'sounds/correct.mp3' : 'sounds/fail.mp3';
                const audio = new Audio(audioPath);
                audio.play().catch(err => console.log('Audio play error:', err));
            }

            const App = () => {
                const [mode, setMode] = useState('menu'); 
                const [currentUser, setCurrentUser] = useState(null);
                const [users, setUsers] = useState([]);
                const [favorites, setFavorites] = useState(new Set());
                const [mistakes, setMistakes] = useState(new Set());
                const [quizProgress, setQuizProgress] = useState({});
                
                const [isFirebaseReady, setIsFirebaseReady] = useState(false);
                const [connectionStatus, setConnectionStatus] = useState('loading'); 
                const [statusText, setStatusText] = useState('è®€å–è³‡æ–™ä¸­...');

                // 1. Firebase Auth & Global Users Listener
                useEffect(() => {
                    if (!auth) {
                        setConnectionStatus('offline');
                        setStatusText('é›¢ç·šæ¨¡å¼');
                        return;
                    }

                    const initAuth = async () => {
                        try {
                            setConnectionStatus('loading');
                            setStatusText('è®€å–è³‡æ–™ä¸­...');
                            await signInAnonymously(auth);
                        } catch (error) {
                            console.error("Auth Error:", error);
                            setConnectionStatus('error');
                            setStatusText('é›²ç«¯åŒæ­¥å¤±æ•—');
                        }
                    };
                    initAuth();

                    const unsubscribeAuth = onAuthStateChanged(auth, (user) => {
                        if (user) {
                            setIsFirebaseReady(true);
                            
                            const globalRef = doc(db, COLLECTION_NAME, DOC_GLOBAL);
                            const unsubscribeGlobal = onSnapshot(globalRef, (docSnap) => {
                                if (docSnap.exists()) {
                                    setUsers(docSnap.data().list || []);
                                } else {
                                    setDoc(globalRef, { list: [] }, { merge: true });
                                    setUsers([]);
                                }
                                setConnectionStatus('success');
                                setStatusText('å·²åŒæ­¥');
                            }, (error) => {
                                console.error("Global Sync Error:", error);
                                setConnectionStatus('error');
                                setStatusText('é›²ç«¯åŒæ­¥å¤±æ•—');
                            });

                            return () => unsubscribeGlobal();
                        } else {
                            setIsFirebaseReady(false);
                        }
                    });

                    return () => unsubscribeAuth();
                }, []);

                // 2. User Data Listener
                useEffect(() => {
                    if (currentUser && isFirebaseReady && db) {
                        const userRef = doc(db, COLLECTION_NAME, currentUser);
                        
                        const unsubscribeUser = onSnapshot(userRef, (docSnap) => {
                            if (docSnap.exists()) {
                                const data = docSnap.data();
                                setFavorites(new Set(data.favorites || []));
                                setMistakes(new Set(data.mistakes || []));
                                setQuizProgress(data.quizProgress || {});
                            } else {
                                setFavorites(new Set());
                                setMistakes(new Set());
                                setQuizProgress({});
                            }
                            setConnectionStatus('success');
                            setStatusText('å·²åŒæ­¥');
                        }, (error) => {
                            console.error("User Sync Error:", error);
                            setConnectionStatus('error');
                            setStatusText('é›²ç«¯åŒæ­¥å¤±æ•—');
                        });

                        return () => unsubscribeUser();
                    } else {
                        setFavorites(new Set());
                        setMistakes(new Set());
                        setQuizProgress({});
                    }
                }, [currentUser, isFirebaseReady]);

                const handleLogin = async (name) => {
                    if (!name.trim()) return;
                    if (!db) {
                        setCurrentUser(name);
                        setMode('menu');
                        return;
                    }
                    try {
                        const globalRef = doc(db, COLLECTION_NAME, DOC_GLOBAL);
                        await setDoc(globalRef, { list: arrayUnion(name) }, { merge: true });
                        setCurrentUser(name);
                        setMode('menu');
                    } catch (e) {
                        console.error("Login Error:", e);
                        alert("ç™»å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š");
                    }
                };

                const handleDeleteUser = async (userToDelete) => {
                    if (!db) return;
                    if (window.confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${userToDelete}ã€çš„ç´€éŒ„å—ï¼Ÿ`)) {
                        if (window.confirm(`åˆªé™¤å¾Œç„¡æ³•å¾©åŸï¼Œæ‚¨çœŸçš„ç¢ºå®šè¦åˆªé™¤ã€Œ${userToDelete}ã€å—ï¼Ÿ`)) {
                            try {
                                const globalRef = doc(db, COLLECTION_NAME, DOC_GLOBAL);
                                await updateDoc(globalRef, { list: arrayRemove(userToDelete) });
                                
                                const userRef = doc(db, COLLECTION_NAME, userToDelete);
                                await deleteDoc(userRef);

                                if (currentUser === userToDelete) {
                                    handleLogout();
                                }
                            } catch (e) {
                                console.error("Delete Error:", e);
                                alert("åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
                            }
                        }
                    }
                };

                const handleLogout = () => {
                    setCurrentUser(null);
                    setMode('menu');
                };

                const saveUserData = useCallback(async (dataToUpdate) => {
                    if(!currentUser || !isFirebaseReady || !db) return;
                    try {
                        setConnectionStatus('loading');
                        const userRef = doc(db, COLLECTION_NAME, currentUser);
                        await setDoc(userRef, dataToUpdate, { merge: true });
                        setTimeout(() => setConnectionStatus('success'), 500); 
                    } catch (e) {
                        console.error("Save Error:", e);
                        setConnectionStatus('error');
                        setStatusText('é›²ç«¯åŒæ­¥å¤±æ•—');
                    }
                }, [currentUser, isFirebaseReady]);

                const toggleFavorite = useCallback((id) => {
                    if (!currentUser) return;
                    const newFavorites = new Set(favorites);
                    if (newFavorites.has(id)) newFavorites.delete(id);
                    else newFavorites.add(id);
                    
                    setFavorites(newFavorites);
                    saveUserData({ favorites: [...newFavorites] });
                }, [favorites, currentUser, saveUserData]);

                const addMistake = useCallback((id) => {
                    if (!currentUser) return;
                    const newMistakes = new Set(mistakes);
                    if (!newMistakes.has(id)) {
                        newMistakes.add(id);
                        setMistakes(newMistakes);
                        saveUserData({ mistakes: [...newMistakes] });
                    }
                }, [mistakes, currentUser, saveUserData]);

                const updateQuizProgress = useCallback((newProgress) => {
                    if(!currentUser) return;
                    setQuizProgress(newProgress);
                    saveUserData({ quizProgress: newProgress });
                }, [currentUser, saveUserData]);

                if (!currentUser) return <LoginView users={users} onLogin={handleLogin} onDeleteUser={handleDeleteUser} connectionStatus={connectionStatus} statusText={statusText} />;
                
                return (
                    <div className="min-h-screen bg-orange-50 text-stone-800 font-sans">
                        <header className="bg-orange-600 text-white p-4 shadow-lg sticky top-0 z-20">
                            <div className="max-w-4xl mx-auto flex justify-between items-center">
                                <div className="flex items-center space-x-2 cursor-pointer" onClick={() => setMode('menu')}>
                                <BookOpen size={28} />
                                <div className="flex flex-col">
                                    <h1 className="text-xl md:text-2xl font-bold tracking-wider">L1é‹å‹•å®¶çš„é¢¨åº¦</h1>
                                    <h2 className="text-xs text-orange-200">å¤šå­—éŸ³ç·´ç¿’</h2>
                                </div>
                                </div>
                                <div className="flex items-center space-x-4">
                                <div className="hidden sm:flex items-center bg-black/20 px-3 py-1 rounded-full text-xs" title={statusText}>
                                    <span className={`status-dot status-${connectionStatus}`}></span>
                                    <span className="text-white/90">{statusText}</span>
                                </div>

                                <div className="hidden md:flex items-center bg-orange-700 px-3 py-1 rounded-full text-sm">
                                    <User size={16} className="mr-2"/>
                                    <span className="font-bold truncate max-w-[100px]">{currentUser}</span>
                                </div>
                                {mode !== 'menu' && (
                                    <button onClick={() => setMode('menu')} className="text-orange-100 hover:text-white transition font-medium">å›é¦–é </button>
                                )}
                                <button onClick={handleLogout} className="flex items-center text-orange-200 hover:text-white transition" title="ç™»å‡º">
                                    <LogOut size={20} />
                                </button>
                                </div>
                            </div>
                        </header>

                        <main className="max-w-4xl mx-auto p-4 md:p-6">
                            {mode === 'menu' && (
                                <div className="flex flex-col items-center justify-center space-y-8 py-12 animate-in fade-in duration-500">
                                <div className="text-center space-y-4">
                                    <div className="bg-orange-100 p-4 rounded-full inline-block mb-2">
                                    <Sun size={48} className="text-orange-500" />
                                    </div>
                                    <h2 className="text-3xl font-bold text-orange-900">æ­¡è¿å›ä¾†ï¼Œ{currentUser}</h2>
                                    <p className="text-stone-600 text-lg max-w-md">è«‹é¸æ“‡ä¸‹åˆ—åŠŸèƒ½é–‹å§‹å­¸ç¿’</p>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-2xl">
                                    <MenuButton onClick={() => setMode('study')} icon={<List size={40} className="text-orange-600" />} title="å…¨è¡¨ç€è¦½" desc="å®Œæ•´æª¢è¦–å¤šéŸ³å­—ã€å­—ç¾©èˆ‡ä¾‹å¥" />
                                    <MenuButton onClick={() => setMode('quiz')} icon={<Zap size={40} className="text-orange-600" />} title="é–ƒé›»åˆ·é¡Œ" desc="ç€‘å¸ƒæµå¼å¿«é€ŸæŒ‘æˆ°" />
                                    <MenuButton onClick={() => setMode('favorites')} icon={<Heart size={40} className="text-red-500 fill-red-500" />} title="æˆ‘çš„æœ€æ„›" desc="è¤‡ç¿’æ‚¨æ”¶è—çš„é‡é»é¡Œç›®" highlight="red" />
                                    <MenuButton onClick={() => setMode('mistakes')} icon={<BookX size={40} className="text-stone-600" />} title="éŒ¯é¡Œè¤‡ç¿’" desc="é‡å°ç­”éŒ¯çš„é¡Œç›®åŠ å¼·ç·´ç¿’" highlight="stone" />
                                </div>

                                <div style={{ marginTop: '20px' }}>
                                    <a href="index.html" 
                                       className="btn btn-gray" 
                                       style={{
                                           textDecoration: 'none', 
                                           padding: '10px 20px',
                                           background: 'linear-gradient(135deg, #ff4081 0%, #d81b60 100%)',
                                           color: 'white', 
                                           borderRadius: '999px', 
                                           display: 'inline-block'
                                       }}>
                                        ğŸ  è¿”å›åœ‹æ–‡å­¸ç¿’ App ç¸½éƒ¨
                                    </a>
                                </div>
                                </div>
                            )}

                            {mode === 'study' && <StudyView data={rawData} favorites={favorites} onToggleFavorite={toggleFavorite} title="å¤šéŸ³å­—è³‡æ–™åº«" />}
                            {mode === 'favorites' && <StudyView data={rawData.filter(item => favorites.has(item.id))} favorites={favorites} onToggleFavorite={toggleFavorite} title="æˆ‘çš„æœ€æ„›æ¸…å–®" emptyMessage="æ‚¨é‚„æ²’æœ‰åŠ å…¥ä»»ä½•æœ€æ„›é¡Œç›®å–”ï¼" />}
                            {mode === 'mistakes' && <StudyView data={rawData.filter(item => mistakes.has(item.id))} favorites={favorites} onToggleFavorite={toggleFavorite} title="éŒ¯é¡Œè¤‡ç¿’æœ¬" emptyMessage="å¤ªæ£’äº†ï¼ç›®å‰æ²’æœ‰éŒ¯é¡Œç´€éŒ„ã€‚" />}
                            {mode === 'quiz' && <WaterfallQuizView data={rawData} initialProgress={quizProgress} onUpdateProgress={updateQuizProgress} favorites={favorites} onToggleFavorite={toggleFavorite} onAddMistake={addMistake} onExit={() => setMode('menu')} />}
                        </main>
                    </div>
                );
            };

            const MenuButton = ({ onClick, icon, title, desc, highlight = "orange" }) => {
                const bgClass = highlight === "red" ? "bg-red-50" : highlight === "stone" ? "bg-stone-100" : "bg-orange-100";
                return (
                    <button onClick={onClick} className="flex flex-col items-center p-8 bg-white rounded-2xl shadow-sm hover:shadow-xl hover:bg-orange-50 transition border-2 border-orange-100 hover:border-orange-300 group">
                        <div className={`${bgClass} p-4 rounded-full mb-4 group-hover:scale-110 transition`}>{icon}</div>
                        <h3 className="text-xl font-bold text-orange-900">{title}</h3>
                        <p className="text-stone-500 mt-2">{desc}</p>
                    </button>
                )
            }

            const LoginView = ({ users, onLogin, onDeleteUser, connectionStatus, statusText }) => {
                const [inputName, setInputName] = useState("");
                return (
                    <div className="min-h-screen bg-orange-50 flex items-center justify-center p-4">
                        <div className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md border-2 border-orange-100 relative">
                            <div className="absolute top-4 right-4 flex items-center bg-stone-100 px-2 py-1 rounded-full text-xs">
                                <span className={`status-dot status-${connectionStatus}`}></span>
                                <span className="text-stone-600">{statusText}</span>
                            </div>

                            <div className="text-center mb-8">
                                <div className="bg-orange-100 p-3 rounded-full inline-block mb-4"><BookOpen size={40} className="text-orange-600" /></div>
                                <h1 className="text-2xl font-bold text-orange-900">å¤šéŸ³å­—å­¸ç¿’App</h1>
                                <p className="text-stone-500 mt-2">è«‹è¼¸å…¥å§“åä»¥é–‹å§‹å­¸ç¿’</p>
                            </div>
                            <form onSubmit={(e) => { e.preventDefault(); if(inputName.trim()) onLogin(inputName.trim()); }} className="space-y-4">
                                <input type="text" value={inputName} onChange={(e) => setInputName(e.target.value)} placeholder="è¼¸å…¥æ‚¨çš„åå­—" className="w-full px-4 py-3 rounded-xl border border-orange-200 focus:outline-none focus:ring-2 focus:ring-orange-400 text-lg" autoFocus />
                                <button type="submit" disabled={!inputName.trim() || connectionStatus === 'loading'} className="w-full py-3 bg-orange-600 hover:bg-orange-700 text-white rounded-xl font-bold text-lg transition disabled:opacity-50">é–‹å§‹ä½¿ç”¨</button>
                            </form>
                            
                            <div className="mt-8">
                                <div className="relative mb-4"><div className="absolute inset-0 flex items-center"><div className="w-full border-t border-stone-200"></div></div><div className="relative flex justify-center text-sm"><span className="px-2 bg-white text-stone-500">å¿«é€Ÿç™»å…¥</span></div></div>
                                
                                {users.length > 0 ? (
                                    <div className="grid grid-cols-2 gap-3">
                                        {users.map((user, idx) => (
                                            <div key={idx} className="relative group">
                                                <button 
                                                    onClick={() => onLogin(user)} 
                                                    className="w-full px-4 py-3 bg-stone-100 hover:bg-orange-100 text-stone-700 hover:text-orange-900 rounded-xl text-base font-bold transition flex items-center justify-center shadow-sm hover:shadow"
                                                >
                                                    {user}
                                                </button>
                                                <button 
                                                    onClick={(e) => { e.stopPropagation(); onDeleteUser(user); }}
                                                    className="absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 hover:bg-red-600 transition shadow-md"
                                                    title="åˆªé™¤ä½¿ç”¨è€…"
                                                >
                                                    <X size={14} />
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                ) : (
                                    <div className="text-center py-4 bg-orange-50/50 rounded-xl border border-dashed border-orange-200">
                                        <p className="text-orange-800 font-medium">å°šç„¡æŒ‘æˆ°è€…ç´€éŒ„ï¼Œæ­¡è¿åŠ å…¥ï¼</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            const StudyView = ({ data, favorites, onToggleFavorite, title, emptyMessage = "æ²’æœ‰æ‰¾åˆ°ç¬¦åˆçš„è³‡æ–™" }) => {
                const [searchTerm, setSearchTerm] = useState("");
                const filteredData = data.filter(item => item.question.includes(searchTerm) || item.answer.includes(searchTerm));

                return (
                    <div className="animate-in fade-in slide-in-from-bottom-4 duration-500 space-y-6">
                    <div className="flex flex-col md:flex-row justify-between items-center gap-4 bg-white p-4 rounded-xl shadow-sm border border-orange-200">
                        <h2 className="text-xl font-bold text-orange-900 flex items-center"><List className="mr-2" size={24} />{title}</h2>
                        <input type="text" placeholder="æœå°‹é¡Œç›®ã€æ³¨éŸ³..." className="px-4 py-2 rounded-lg border border-orange-200 focus:outline-none focus:ring-2 focus:ring-orange-400 w-full md:w-64 bg-white" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                    </div>
                    
                    {filteredData.length > 0 ? (
                        <div className="grid grid-cols-1 gap-4">
                        {filteredData.map((item) => (
                            <div key={item.id} className="bg-white rounded-xl shadow-sm border border-orange-100 overflow-hidden hover:shadow-md transition">
                                <div className="p-4 bg-orange-50 border-b border-orange-100 flex justify-between items-start">
                                    <div className="flex items-center gap-3">
                                        <span className="bg-orange-200 text-orange-800 text-xs font-bold px-2 py-1 rounded">#{item.id}</span>
                                        <h3 className="text-xl font-bold text-stone-800">{item.question}</h3>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <span className="text-2xl font-bold text-orange-600 font-mono tracking-widest">{item.answer}</span>
                                        <button onClick={() => onToggleFavorite(item.id)} className={`transition transform active:scale-90 p-1 rounded-full hover:bg-orange-100 ${favorites.has(item.id) ? 'text-red-500' : 'text-stone-300 hover:text-red-400'}`}>
                                            <Heart size={20} className={favorites.has(item.id) ? "fill-current heart-click" : ""} />
                                        </button>
                                    </div>
                                </div>
                                <div className="p-4 space-y-3">
                                    <div>
                                        <div className="flex items-center gap-2 mb-1">
                                            <span className="text-xs font-bold text-stone-400 uppercase tracking-wider">å­—ç¾©è£œå……</span>
                                            <span className="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-0.5 rounded flex items-center"><Tag size={12} className="mr-1"/>{item.partOfSpeech}</span>
                                        </div>
                                        <p className="text-stone-700 mt-1">{item.meaning}</p>
                                    </div>
                                    <div className="bg-stone-50 p-3 rounded-lg border border-stone-100">
                                        <span className="text-xs font-bold text-stone-400 uppercase tracking-wider">å®Œæ•´ä¾‹å¥</span>
                                        <p className="text-stone-600 mt-1 leading-relaxed">{item.sentence}</p>
                                    </div>
                                </div>
                            </div>
                        ))}
                        </div>
                    ) : (
                        <div className="p-12 text-center text-stone-400 bg-white rounded-xl border border-dashed border-stone-300">
                            <List size={48} className="mx-auto mb-4 opacity-50" />
                            <p>{emptyMessage}</p>
                        </div>
                    )}
                    <div className="text-center text-sm text-stone-500 mt-4">é¡¯ç¤º {filteredData.length} ç­†è³‡æ–™</div>
                    </div>
                );
            };

            const WaterfallQuizView = ({ data, initialProgress, onUpdateProgress, favorites, onToggleFavorite, onAddMistake, onExit }) => {
                const [quizData, setQuizData] = useState([]);
                const [selections, setSelections] = useState(initialProgress || {});

                useEffect(() => {
                    const preparedData = data.map(item => ({ ...item, options: shuffleArray([item.answer, ...item.distractors]) }));
                    setQuizData(preparedData);
                    if(initialProgress) {
                        setSelections(initialProgress);
                    }
                }, [data, initialProgress]);

                const handleSelect = (questionId, option) => {
                    const newSelections = { ...selections, [questionId]: option };
                    setSelections(newSelections);
                    onUpdateProgress(newSelections);
                    
                    const currentQuestion = data.find(item => item.id === questionId);
                    const isCorrect = option === currentQuestion.answer;
                    if (isCorrect) {
                        playSound('success');
                        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                    } else {
                        playSound('error');
                        onAddMistake(questionId);
                    }
                };
                
                const completedCount = Object.keys(selections).length;
                const progress = Math.round((completedCount / data.length) * 100);

                return (
                    <div className="max-w-4xl mx-auto pb-20">
                    <div className="sticky top-16 z-10 bg-orange-50/95 backdrop-blur-sm pt-4 pb-2 border-b border-orange-200 mb-6 shadow-sm">
                        <div className="flex justify-between items-center mb-2 px-2">
                            <div>
                                <h2 className="text-xl font-bold text-orange-900 flex items-center gap-2"><Zap size={24} className="fill-orange-500 text-orange-600"/>é–ƒé›»åˆ·é¡Œ</h2>
                                <p className="text-xs text-stone-500 mt-1">å·²å®Œæˆ: {completedCount} / {data.length} é¡Œ</p>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => { if(window.confirm('ç¢ºå®šè¦æ¸…ç©ºé€²åº¦é‡ä¾†å—ï¼Ÿ')) { const empty = {}; setSelections(empty); onUpdateProgress(empty); window.scrollTo(0,0); }}} className="px-3 py-1.5 bg-white border border-orange-300 text-orange-700 rounded-lg hover:bg-orange-50 font-medium text-xs sm:text-sm transition">é‡ç½®</button>
                                <button onClick={onExit} className="px-3 py-1.5 bg-stone-600 text-white rounded-lg hover:bg-stone-700 font-medium text-xs sm:text-sm transition">æš«åœ</button>
                            </div>
                        </div>
                        <div className="w-full bg-orange-200 h-2.5 rounded-full overflow-hidden"><div className="bg-orange-600 h-2.5 rounded-full progress-bar shadow-[0_0_10px_rgba(249,115,22,0.5)]" style={{ width: `${progress}%` }}></div></div>
                    </div>

                    <div className="space-y-6">
                        {quizData.map((item) => {
                            const userSelection = selections[item.id];
                            const isAnswered = userSelection !== undefined;
                            const isCorrect = userSelection === item.answer;
                            
                            return (
                                <div key={item.id} className={`bg-white rounded-xl shadow-sm border-2 transition-all duration-300 overflow-hidden ${isAnswered ? (isCorrect ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50') : 'border-orange-100'}`}>
                                    <div className="p-4 border-b border-black/5 flex items-start gap-3">
                                        <span className="bg-orange-100 text-orange-800 font-mono font-bold px-2 py-1 rounded text-sm shrink-0 mt-1">#{item.id}</span>
                                        <div className="flex-1">
                                            <div className="flex items-center gap-2">
                                                <button onClick={(e) => { e.stopPropagation(); onToggleFavorite(item.id); }} className={`transition transform active:scale-90 p-1 rounded-full -ml-2 ${favorites.has(item.id) ? 'text-red-500' : 'text-stone-300 hover:text-red-400'}`}>
                                                    <Heart size={20} className={favorites.has(item.id) ? "fill-current heart-click" : ""} />
                                                </button>
                                                <h3 className="text-xl md:text-2xl font-bold text-stone-800 leading-snug">{item.question}</h3>
                                            </div>
                                        </div>
                                        {isAnswered && <div className="ml-auto shrink-0">{isCorrect ? <CheckCircle className="text-green-500" /> : <XCircle className="text-red-500" />}</div>}
                                    </div>
                                    <div className="p-4 bg-white/50">
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                                            {item.options.map((option, idx) => {
                                                let btnClass = "py-4 px-2 rounded-lg font-bold text-2xl md:text-3xl transition-all border-2 relative ";
                                                if (isAnswered) {
                                                    if (option === item.answer) btnClass += "bg-green-500 text-white border-green-600 shadow-md";
                                                    else if (option === userSelection && !isCorrect) btnClass += "bg-red-500 text-white border-red-600 shadow-md";
                                                    else btnClass += "bg-stone-100 text-stone-400 border-transparent opacity-50";
                                                } else {
                                                    btnClass += "bg-white text-stone-700 border-stone-200 hover:border-orange-400 hover:bg-orange-50 active:scale-95";
                                                }
                                                return <button key={idx} onClick={() => !isAnswered && handleSelect(item.id, option)} disabled={isAnswered} className={btnClass}>{option}</button>;
                                            })}
                                        </div>
                                        {isAnswered && (
                                            <div className="mt-4 pt-4 border-t border-black/5 animate-in fade-in slide-in-from-top-2">
                                                <div className="bg-white/60 p-3 rounded-lg border border-stone-100">
                                                    <div className="flex items-center gap-2 mb-1">
                                                        <span className="text-sm font-bold text-stone-500">å­—ç¾©è£œå……</span>
                                                        <span className="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-0.5 rounded flex items-center"><Tag size={12} className="mr-1"/>{item.partOfSpeech}</span>
                                                    </div>
                                                    <p className="text-stone-800 mb-3">{item.meaning}</p>
                                                    <p className="text-sm font-bold text-stone-500 mb-1">ä¾‹å¥</p>
                                                    <p className="text-stone-600 italic leading-relaxed">{item.sentence}</p>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    {progress === 100 && (
                        <div className="mt-8 p-8 bg-green-100 rounded-2xl text-center border-2 border-green-300 animate-in zoom-in duration-300">
                            <h3 className="text-2xl font-bold text-green-800 mb-2">æ­å–œå®Œæˆæ‰€æœ‰é¡Œç›®ï¼</h3>
                            <button onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })} className="mt-4 text-green-700 underline hover:text-green-900">å›åˆ°é ‚éƒ¨</button>
                        </div>
                    )}
                    </div>
                );
            };

            const root = createRoot(document.getElementById('root'));
            root.render(<App />);
        }
    </script>
</body>
</html>